# Apache 서버 설정 파일
# FastComet 호스팅용 .htaccess

# 리라이트 엔진 활성화
RewriteEngine On

# HTTPS 강제 리다이렉션 (SSL 인증서가 있는 경우)
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# www 제거 (선택사항: www 없이 도메인만 사용)
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Admin 페이지 리라이트
RewriteRule ^admin/?$ /admin.html [L]

# SPA 모드: 모든 페이지 요청을 루트로 리다이렉트하고 URL 유지
# 실제 파일이나 디렉토리가 아닌 경우 index.html로 리라이트
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api\.php
RewriteCond %{REQUEST_URI} !^/auth\.php
RewriteCond %{REQUEST_URI} !^/upload\.php
RewriteCond %{REQUEST_URI} !^/uploads/
RewriteCond %{REQUEST_URI} !^/admin\.html
RewriteRule ^.*$ /index.html [L,QSA]

# DirectoryIndex 설정 (기본 페이지)
DirectoryIndex index.html

# 보안 설정
# config.php 파일 직접 접근 차단
<Files "config.php">
    Order Allow,Deny
    Deny from all
</Files>

# create_admin.php 파일 직접 접근 차단 (사용 후 삭제 권장)
<Files "create_admin.php">
    Order Allow,Deny
    Deny from all
</Files>

# test_api.php 파일 직접 접근 차단 (사용 후 삭제 권장)
<Files "test_api.php">
    Order Allow,Deny
    Deny from all
</Files>

# .htaccess 자체 접근 차단
<Files ".htaccess">
    Order Allow,Deny
    Deny from all
</Files>

# SQL 파일 접근 차단
<FilesMatch "\.(sql)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# 에러 페이지 설정 (선택사항)
# ErrorDocument 404 /404.html
# ErrorDocument 500 /500.html

# 브라우저 캐싱 설정
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
</IfModule>

# Gzip 압축 설정
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>
